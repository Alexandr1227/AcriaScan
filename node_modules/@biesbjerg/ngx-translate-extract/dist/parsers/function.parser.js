"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const typescript_1 = require("typescript");
const abstract_ast_parser_1 = require("./abstract-ast.parser");
const translation_collection_1 = require("../utils/translation.collection");
class FunctionParser extends abstract_ast_parser_1.AbstractAstParser {
    constructor(options) {
        super();
        this.functionIdentifier = 'marker';
        if (options && typeof options.identifier !== 'undefined') {
            this.functionIdentifier = options.identifier;
        }
    }
    extract(template, path) {
        let collection = new translation_collection_1.TranslationCollection();
        this.sourceFile = this.createSourceFile(path, template);
        const callNodes = this.findCallNodes();
        callNodes.forEach(callNode => {
            const keys = this.getStringLiterals(callNode);
            if (keys && keys.length) {
                collection = collection.addKeys(keys);
            }
        });
        return collection;
    }
    findCallNodes(node) {
        if (!node) {
            node = this.sourceFile;
        }
        let callNodes = this.findNodes(node, [typescript_1.SyntaxKind.CallExpression]);
        callNodes = callNodes
            .filter(callNode => {
            if (callNode.arguments.length < 1) {
                return false;
            }
            const identifier = callNode.getChildAt(0).text;
            if (identifier !== this.functionIdentifier) {
                return false;
            }
            return true;
        });
        return callNodes;
    }
}
exports.FunctionParser = FunctionParser;
//# sourceMappingURL=function.parser.js.map